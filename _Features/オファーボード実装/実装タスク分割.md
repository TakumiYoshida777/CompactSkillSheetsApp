# オファーボード機能実装 タスク分割書

作成日: 2025年1月17日

## 実装概要
取引先企業向けオファーボード機能（CLI001〜CLI005）を5人のエンジニアで実装

## チーム構成と担当割り当て

### 👤 エンジニアA: バックエンドAPI担当
**主要責任**: オファー機能のバックエンドAPI全般

### 👤 エンジニアB: データベース・インフラ担当  
**主要責任**: データベース設計・マイグレーション・パフォーマンス最適化

### 👤 エンジニアC: フロントエンド基盤担当
**主要責任**: React基盤・状態管理・共通コンポーネント

### 👤 エンジニアD: UI実装担当
**主要責任**: 画面UI実装・レスポンシブ対応

### 👤 エンジニアE: 統合・テスト担当
**主要責任**: 機能統合・E2Eテスト・品質保証

---

## 🔵 エンジニアA: バックエンドAPI担当

### 実装タスク
1. **オファー管理APIの実装**
   - POST `/api/client/offers` - オファー送信API
   - GET `/api/client/offers` - オファー一覧取得API
   - GET `/api/client/offers/{id}` - オファー詳細取得API
   - PUT `/api/client/offers/{id}/status` - ステータス更新API
   - POST `/api/client/offers/{id}/reminder` - リマインド送信API
   - POST `/api/client/offers/bulk-action` - 一括操作API

2. **オファーボードAPIの実装**
   - GET `/api/client/offer-board` - オファーボード情報取得
   - GET `/api/client/offer-history` - オファー履歴取得
   - GET `/api/client/offers/statistics` - 統計情報API

3. **メール送信機能**
   - オファー送信時のメール通知機能
   - リマインドメール送信機能
   - メールテンプレート管理

### 実装ファイル
```
backend/src/
├── controllers/
│   └── client/
│       ├── offerController.ts
│       └── offerBoardController.ts
├── services/
│   ├── offerService.ts
│   └── emailService.ts
├── routes/
│   └── client/
│       └── offerRoutes.ts
└── validators/
    └── offerValidator.ts
```

### 実装例
```typescript
// backend/src/controllers/client/offerController.ts
export class OfferController {
  async createOffer(req: Request, res: Response) {
    const { engineer_ids, project_details, send_email } = req.body;
    
    // バリデーション
    const validation = await offerValidator.validate(req.body);
    if (!validation.valid) {
      return res.status(400).json({ errors: validation.errors });
    }
    
    // オファー作成
    const offer = await offerService.createOffer({
      client_company_id: req.user.companyId,
      engineer_ids,
      project_details,
      created_by: req.user.id
    });
    
    // メール送信
    if (send_email) {
      await emailService.sendOfferEmails(offer);
    }
    
    return res.status(201).json(offer);
  }
}
```

---

## 🟢 エンジニアB: データベース・インフラ担当

### 実装タスク
1. **データベーステーブル作成**
   - `offers`テーブルの作成
   - `offer_engineers`テーブルの作成
   - インデックス設定
   - 外部キー制約設定

2. **Prismaスキーマ定義**
   - モデル定義
   - リレーション設定
   - マイグレーションファイル作成

3. **リポジトリ層実装**
   - OfferRepository
   - OfferEngineerRepository
   - 複雑なクエリの最適化

### 実装ファイル
```
backend/
├── prisma/
│   ├── schema.prisma
│   └── migrations/
│       └── 20250117_add_offers_tables/
│           └── migration.sql
└── src/
    └── repositories/
        ├── offerRepository.ts
        └── offerEngineerRepository.ts
```

### Prismaスキーマ例
```prisma
// prisma/schema.prisma
model Offer {
  id                   BigInt           @id @default(autoincrement())
  offerNumber          String           @unique @map("offer_number")
  clientCompanyId      BigInt           @map("client_company_id")
  status               OfferStatus      @default(SENT)
  projectName          String           @map("project_name")
  projectPeriodStart   DateTime         @map("project_period_start")
  projectPeriodEnd     DateTime         @map("project_period_end")
  requiredSkills       Json?            @map("required_skills")
  projectDescription   String           @map("project_description")
  location             String?
  rateMin              Int?             @map("rate_min")
  rateMax              Int?             @map("rate_max")
  remarks              String?
  sentAt               DateTime         @map("sent_at")
  openedAt             DateTime?        @map("opened_at")
  respondedAt          DateTime?        @map("responded_at")
  reminderSentAt       DateTime?        @map("reminder_sent_at")
  reminderCount        Int              @default(0) @map("reminder_count")
  createdBy            BigInt           @map("created_by")
  createdAt            DateTime         @default(now()) @map("created_at")
  updatedAt            DateTime         @updatedAt @map("updated_at")
  
  clientCompany        Company          @relation(fields: [clientCompanyId], references: [id])
  creator              User             @relation(fields: [createdBy], references: [id])
  offerEngineers       OfferEngineer[]
  
  @@map("offers")
  @@index([clientCompanyId])
  @@index([status])
  @@index([sentAt])
}

enum OfferStatus {
  SENT
  OPENED
  PENDING
  ACCEPTED
  DECLINED
  WITHDRAWN
  
  @@map("offer_status")
}
```

---

## 🟡 エンジニアC: フロントエンド基盤担当

### 実装タスク
1. **状態管理（Zustand）**
   - オファーストアの実装
   - エンジニア選択状態管理
   - フィルター状態管理

2. **API通信層（TanStack Query）**
   - オファーAPI hooks
   - キャッシュ戦略
   - 楽観的更新

3. **共通コンポーネント**
   - エンジニア検索コンポーネント（共通化）
   - オファーステータスバッジ
   - 日付ピッカー
   - 複数選択チェックボックス

### 実装ファイル
```
frontend/src/
├── stores/
│   └── offerStore.ts
├── hooks/
│   ├── useOffers.ts
│   ├── useOfferBoard.ts
│   └── useOfferMutations.ts
├── api/
│   └── client/
│       └── offerApi.ts
└── components/
    └── common/
        ├── EngineerSearch/
        ├── OfferStatusBadge/
        └── MultiSelectList/
```

### Zustandストア例
```typescript
// frontend/src/stores/offerStore.ts
import { create } from 'zustand';

interface OfferStore {
  selectedEngineers: string[];
  filterStatus: OfferStatus[];
  projectDetails: ProjectDetails | null;
  
  toggleEngineer: (engineerId: string) => void;
  selectAllEngineers: (engineerIds: string[]) => void;
  clearSelection: () => void;
  setProjectDetails: (details: ProjectDetails) => void;
}

export const useOfferStore = create<OfferStore>((set) => ({
  selectedEngineers: [],
  filterStatus: ['SENT', 'PENDING', 'OPENED'],
  projectDetails: null,
  
  toggleEngineer: (engineerId) => 
    set((state) => ({
      selectedEngineers: state.selectedEngineers.includes(engineerId)
        ? state.selectedEngineers.filter(id => id !== engineerId)
        : [...state.selectedEngineers, engineerId]
    })),
    
  selectAllEngineers: (engineerIds) => 
    set({ selectedEngineers: engineerIds }),
    
  clearSelection: () => 
    set({ selectedEngineers: [] }),
    
  setProjectDetails: (details) => 
    set({ projectDetails: details })
}));
```

---

## 🟠 エンジニアD: UI実装担当

### 実装タスク
1. **オファーボード画面（CLI001）**
   - サマリーカード実装
   - エンジニア一覧テーブル
   - 複数選択UI
   - オファー送信ダイアログ

2. **オファー管理画面（CLI004）**
   - 統計ダッシュボード
   - ステータスフィルター
   - アクティブオファー一覧
   - アクション操作UI

3. **オファー履歴画面（CLI005）**
   - 検索・フィルターUI
   - 履歴カード表示
   - ページネーション
   - エクスポート機能

### 実装ファイル
```
frontend/src/
├── pages/
│   └── client/
│       ├── OfferBoard/
│       │   ├── index.tsx
│       │   ├── OfferSummary.tsx
│       │   ├── EngineerList.tsx
│       │   └── OfferDialog.tsx
│       ├── OfferManagement/
│       │   ├── index.tsx
│       │   ├── OfferStatistics.tsx
│       │   └── ActiveOffers.tsx
│       └── OfferHistory/
│           ├── index.tsx
│           └── OfferHistoryCard.tsx
└── styles/
    └── client/
        └── offer.module.css
```

### React実装例
```tsx
// frontend/src/pages/client/OfferBoard/index.tsx
import { useState } from 'react';
import { Card, Table, Button, Checkbox, Badge } from 'antd';
import { useOfferBoard } from '@/hooks/useOfferBoard';
import { useOfferStore } from '@/stores/offerStore';

export const OfferBoard: React.FC = () => {
  const { data: boardData, isLoading } = useOfferBoard();
  const { selectedEngineers, toggleEngineer } = useOfferStore();
  const [showOfferDialog, setShowOfferDialog] = useState(false);
  
  const columns = [
    {
      title: '',
      dataIndex: 'select',
      render: (_, record) => (
        <Checkbox
          checked={selectedEngineers.includes(record.id)}
          onChange={() => toggleEngineer(record.id)}
        />
      )
    },
    {
      title: 'エンジニア',
      dataIndex: 'name',
      render: (name, record) => (
        <div>
          <strong>{name}</strong>
          <div className="text-gray-500">
            {record.skills.join(', ')} | {record.experience}年
          </div>
        </div>
      )
    },
    {
      title: 'オファー状況',
      dataIndex: 'offerStatus',
      render: (status) => (
        <Badge status={getStatusColor(status)} text={getStatusText(status)} />
      )
    }
  ];
  
  return (
    <div className="offer-board">
      <OfferSummary data={boardData?.summary} />
      
      <Card title="オファー可能エンジニア一覧">
        <div className="mb-4">
          <Button 
            type="primary"
            disabled={selectedEngineers.length === 0}
            onClick={() => setShowOfferDialog(true)}
          >
            選択したエンジニアにオファー送信
          </Button>
        </div>
        
        <Table
          columns={columns}
          dataSource={boardData?.engineers}
          loading={isLoading}
          rowKey="id"
        />
      </Card>
      
      <OfferDialog
        visible={showOfferDialog}
        onClose={() => setShowOfferDialog(false)}
        selectedEngineers={selectedEngineers}
      />
    </div>
  );
};
```

---

## 🔴 エンジニアE: 統合・テスト担当

### 実装タスク
1. **機能統合**
   - 各担当の実装を統合
   - エンドツーエンドの動作確認
   - データフロー最適化

2. **テスト実装**
   - APIテスト（Jest）
   - コンポーネントテスト（React Testing Library）
   - E2Eテスト（Playwright）
   - 統合テスト

3. **品質保証**
   - パフォーマンステスト
   - セキュリティチェック
   - アクセシビリティ確認

### 実装ファイル
```
tests/
├── unit/
│   ├── api/
│   │   └── offer.test.ts
│   └── components/
│       └── OfferBoard.test.tsx
├── integration/
│   └── offerFlow.test.ts
└── e2e/
    ├── offerBoard.spec.ts
    └── offerManagement.spec.ts
```

### テスト実装例
```typescript
// tests/e2e/offerBoard.spec.ts
import { test, expect } from '@playwright/test';

test.describe('オファーボード機能', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/client/offer-board');
    await page.waitForLoadState('networkidle');
  });
  
  test('複数エンジニア選択とオファー送信', async ({ page }) => {
    // エンジニア選択
    await page.locator('input[type="checkbox"]').first().check();
    await page.locator('input[type="checkbox"]').nth(1).check();
    
    // オファー送信ボタンクリック
    await page.click('button:has-text("選択したエンジニアにオファー送信")');
    
    // ダイアログ表示確認
    await expect(page.locator('.offer-dialog')).toBeVisible();
    
    // 案件詳細入力
    await page.fill('input[name="projectName"]', 'ECサイトリニューアル');
    await page.fill('textarea[name="projectDescription"]', 'React/TypeScriptでの開発');
    
    // 送信
    await page.click('button:has-text("オファー送信")');
    
    // 成功メッセージ確認
    await expect(page.locator('.ant-message-success')).toBeVisible();
  });
  
  test('オファーステータスフィルタリング', async ({ page }) => {
    // フィルター適用
    await page.click('input[value="未オファー"]');
    
    // テーブル更新確認
    await expect(page.locator('table tbody tr')).toHaveCount(10);
    
    // ステータス確認
    const statuses = await page.locator('.offer-status').allTextContents();
    statuses.forEach(status => {
      expect(status).toBe('未送信');
    });
  });
});
```

---

## 実装スケジュール

### Week 1
- **Day 1-2**: 
  - B: データベース設計・マイグレーション
  - A: API仕様設計
  - C: フロントエンド基盤設計
  
- **Day 3-5**:
  - B: リポジトリ層実装
  - A: オファーAPI実装開始
  - C: 状態管理・API hooks実装
  - D: UI基本レイアウト作成

### Week 2
- **Day 6-8**:
  - A: メール送信機能実装
  - C: 共通コンポーネント実装
  - D: 各画面UI実装
  - E: テストケース作成開始

- **Day 9-10**:
  - 全員: 機能統合
  - E: E2Eテスト実装
  - バグ修正・最終調整

---

## コミュニケーション

### デイリースタンドアップ
- 毎日10:00
- 進捗共有と課題確認

### API仕様調整会議
- Day 2 14:00（A, B, C参加）

### UI/UXレビュー
- Day 5 15:00（C, D, E参加）

### 統合テスト
- Day 8 13:00（全員参加）

---

## 成果物チェックリスト

### エンジニアA
- [ ] オファーAPI（6エンドポイント）
- [ ] メール送信機能
- [ ] APIドキュメント

### エンジニアB
- [ ] データベーステーブル
- [ ] Prismaスキーマ
- [ ] マイグレーション完了

### エンジニアC
- [ ] Zustandストア
- [ ] API hooks（TanStack Query）
- [ ] 共通コンポーネント3種

### エンジニアD
- [ ] オファーボード画面
- [ ] オファー管理画面
- [ ] オファー履歴画面

### エンジニアE
- [ ] APIテスト（カバレッジ80%）
- [ ] E2Eテスト（主要フロー）
- [ ] 性能テストレポート