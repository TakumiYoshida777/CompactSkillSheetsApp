# エンジニア登録機能 - 現状分析レポート

## 調査日時
2025-08-19

## 1. 調査概要

エンジニア登録機能について、現在の実装状況と要件定義書で定められた理想の仕様を比較し、ギャップ分析を実施しました。

## 2. 現状の実装

### 2.1 フロントエンド実装状況

#### 実装済みファイル
- `/frontend/src/pages/Engineers/EngineerRegister.tsx`
- `/frontend/src/api/engineers/engineerApi.ts`
- `/frontend/src/types/engineer.ts`

#### 実装済み機能
1. **UI/UX設計**
   - 4ステップのウィザード形式で実装
     - Step 1: 基本情報（氏名、連絡先、住所等）
     - Step 2: 経歴・スキル情報
     - Step 3: 契約・稼働情報
     - Step 4: 登録内容確認
   - レスポンシブデザイン対応
   - Ant Designコンポーネント使用

2. **フォーム機能**
   - 入力バリデーション実装
   - 必須項目チェック
   - メールアドレス形式検証
   - 日付選択機能
   - 動的なスキル追加/削除機能

3. **データ構造**
   ```typescript
   // スキル情報
   interface SkillItem {
     name: string;
     level: number;    // 1-5のレベル
     experience: number; // 経験年数
   }
   ```

4. **ファイルアップロード**
   - 履歴書アップロード対応
   - スキルシートアップロード対応
   - プロフィール画像アップロード（API定義済み）

### 2.2 バックエンド実装状況

#### 実装済みAPI

1. **エンジニア管理API** (`/backend/src/routes/v1/engineer.routes.ts`)
   ```typescript
   // 基本CRUD
   GET    /api/v1/engineers         // 一覧取得
   GET    /api/v1/engineers/:id     // 詳細取得
   POST   /api/v1/engineers         // 新規作成
   PUT    /api/v1/engineers/:id     // 更新
   DELETE /api/v1/engineers/:id     // 削除
   
   // ステータス管理
   PATCH  /api/v1/engineers/:id/status
   PATCH  /api/v1/engineers/:id/availability
   PATCH  /api/v1/engineers/:id/public
   
   // 一括操作
   PATCH  /api/v1/engineers/bulk/status
   POST   /api/v1/engineers/bulk/export
   ```

2. **サービス層実装** (`/backend/src/services/engineer.service.ts`)
   - Prismaを使用したDB操作
   - トランザクション処理
   - スキルシート自動生成
   - 完了率計算ロジック
   - マルチテナント対応（companyId分離）

3. **バリデーション** (`/backend/src/validators/engineer.validator.ts`)
   - express-validatorによる入力検証
   - 必須項目チェック
   - データ型検証
   - ビジネスルール検証

## 3. 要件定義書の理想仕様

### 3.1 権限要件
- **登録権限**: 管理者・営業権限のみ
- **編集権限**: エンジニア本人（自身のデータのみ）
- **閲覧権限**: 役割に応じた制御

### 3.2 必須データ項目
1. **基本情報**
   - 氏名、連絡先、経歴
   - 現在の参画状況
   - 稼働可能時期

2. **スキル情報**
   - 技術スキル（プログラミング言語、フレームワーク等）
   - 業務経験・プロジェクト経歴
   - 資格・認定
   - 対応可能ロール（PG、PL、PM、EM）
   - 対応可能フェーズ（要件定義、基本設計、詳細設計、DB設計、開発等）

### 3.3 公開制御要件
- 企業所属エンジニア：デフォルト公開
- 営業以上の権限で変更可能
- スキルシート入力完了後に公開可能

## 4. ギャップ分析

### 4.1 未実装機能

#### 🔴 重要度：高
1. **API統合未完了**
   - フロントエンドの`handleSubmit`関数が仮実装（console.logのみ）
   - 実際のAPI呼び出し処理が未実装
   ```typescript
   // 現在の実装（EngineerRegister.tsx）
   const handleSubmit = async (values: any) => {
     console.log('Form values:', values);  // 仮実装
     console.log('Skills:', skills);
     // APIコール未実装
   }
   ```

2. **権限チェック未実装**
   - 登録画面へのアクセス制御なし
   - ロールベースアクセス制御（RBAC）の実装が必要

3. **スキルシート連携不完全**
   - エンジニア登録時のスキルシート初期化処理はバックエンドのみ
   - フロントエンドからの連携が未実装

#### 🟡 重要度：中
1. **データ検証機能**
   - 重複メールアドレスチェック（リアルタイム）
   - 既存エンジニアとの重複確認

2. **UX改善項目**
   - プログレス保存（途中保存機能）
   - 入力データの一時保存（localStorage等）
   - スキル入力のサジェスト機能

3. **データ構造の最適化**
   - スキル情報の正規化（マスタテーブル管理）
   - プロジェクト経歴の構造化

#### 🟢 重要度：低
1. **便利機能**
   - CSV一括登録
   - テンプレート機能
   - 入力履歴からの自動補完

### 4.2 実装済みだが改善が必要な項目

1. **ステータス管理**
   - 現在：`waiting`, `assigned`, `upcoming`, `inactive`
   - 要件：`working`, `waiting`, `waiting_soon`, `leaving`
   - マッピングの調整が必要

2. **スキルレベル表現**
   - 現在：1-5の数値
   - 改善案：より詳細な評価基準の定義

## 5. 推奨対応プラン

### Phase 1：即対応（1-2日）
1. **API統合実装**
   ```typescript
   // 実装例
   const handleSubmit = async (values: any) => {
     setLoading(true);
     try {
       const engineerData: EngineerCreateRequest = {
         name: `${values.lastName} ${values.firstName}`,
         nameKana: `${values.lastNameKana} ${values.firstNameKana}`,
         email: values.email,
         phone: values.phone,
         // ... その他のフィールドマッピング
       };
       
       const result = await engineerApi.create(engineerData);
       
       // スキル情報の登録
       if (skills.length > 0) {
         await skillSheetApi.updateSkills(result.id, skills);
       }
       
       message.success('エンジニア情報を登録しました');
       navigate(`/engineers/${result.id}`);
     } catch (error) {
       message.error('登録に失敗しました');
     } finally {
       setLoading(false);
     }
   };
   ```

2. **権限チェック追加**
   ```typescript
   // ページコンポーネントに権限チェックを追加
   const EngineerRegister: React.FC = () => {
     const { user } = useAuth();
     
     // 権限チェック
     if (!['admin', 'sales'].includes(user.role)) {
       return <Unauthorized />;
     }
     
     // ... 既存の実装
   };
   ```

### Phase 2：優先度高（3-5日）
1. **重複チェック機能**
   - メールアドレスのリアルタイム検証
   - デバウンス処理での最適化

2. **プログレス保存機能**
   - localStorageへの一時保存
   - ページリロード時の復元

3. **スキルマスタ連携**
   - スキル候補のAPI作成
   - オートコンプリート実装

### Phase 3：機能拡張（1週間）
1. **一括登録機能**
   - CSVアップロード機能
   - バリデーション結果のプレビュー
   - エラー行の特定と修正

2. **テンプレート機能**
   - よく使うパターンの保存
   - テンプレートからの新規作成

3. **高度な検証**
   - 経歴の整合性チェック
   - スキルと経験年数の妥当性検証

## 6. リスクと対策

### 6.1 技術的リスク
- **パフォーマンス**: 大量データ登録時の処理速度
  - 対策：バッチ処理、非同期処理の実装

- **データ整合性**: 複数テーブルへの同時更新
  - 対策：トランザクション処理の徹底

### 6.2 運用リスク
- **誤登録**: 権限を持つユーザーによる誤った登録
  - 対策：確認画面の充実、編集履歴の保存

- **データ品質**: 不完全な情報での登録
  - 対策：必須項目の明確化、ガイダンスの提供

## 7. まとめ

エンジニア登録機能は、UI/UXとバックエンドAPIの基本実装は完了していますが、フロントエンドとバックエンドの統合が未完了です。最優先事項として、API統合と権限チェックの実装を行い、その後段階的にUX改善と機能拡張を進めることを推奨します。

特に重要なのは：
1. API統合による実際のデータ登録機能の実現
2. 権限に基づくアクセス制御の実装
3. スキルシートとの適切な連携

これらの実装により、要件定義書で定められた基本機能を満たすことができます。