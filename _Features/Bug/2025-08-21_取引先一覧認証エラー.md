# 取引先一覧画面 認証エラー調査結果

## 発生日時
2025年8月21日

## 問題の概要
取引先一覧画面（http://localhost:3001/business-partners/list）にアクセス時に認証エラーが発生

## エラー内容
```
GET http://localhost:3001/src/api/businessPartner.ts 500 (Internal Server Error)
Failed to fetch dynamically imported module
```

その後、APIエンドポイントへのアクセスで401 Unauthorizedエラー

## 調査結果

### 1. 直接の原因
`/api/v1/partner-list`エンドポイントで認証トークンが必要だが、フロントエンドから送信されていない

### 2. エラーレスポンス詳細
```json
{
  "success": false,
  "error": {
    "code": "UNAUTHORIZED",
    "message": "認証トークンが必要です"
  }
}
```

### 3. 関連ファイル
- `/backend/src/routes/v1/partnerList.routes.ts` - `authenticateToken`ミドルウェアを適用
- `/frontend/src/api/businessPartner.ts` - API呼び出し実装
- `/frontend/src/pages/BusinessPartners/BusinessPartnerList.tsx` - 画面コンポーネント

### 4. 根本原因の可能性
1. **インポートパスの問題**
   - エイリアスパス（@/api）から相対パス（../../api）への変更は完了済み
   
2. **認証トークンの未送信**
   - `businessPartnerApi`が認証トークンを含むaxiosインスタンスを使用していない可能性
   - またはaxiosインスタンスのインターセプターが正しく設定されていない

3. **その他のエラー（過去ログから）**
   - `company-1`をBigIntに変換できないエラーも発生していた
   - 企業IDの形式が想定と異なる可能性

## 必要な修正

### 1. フロントエンド側
- `businessPartnerApi`で使用するaxiosインスタンスの確認
- 認証トークンを含むヘッダーが正しく設定されているか確認
- インポートパスの確認（既に修正済み）

### 2. バックエンド側
- 認証ミドルウェアのログ出力追加（デバッグ用）
- エラーハンドリングの改善

## 参考情報

### HTTPリクエストログ
```
2025-08-21 08:12:29 [INFO]: GET /api/v1/analytics/dashboard 200 95.260 ms
```
→ analyticsは正常にアクセスできている

### curl確認結果
```bash
curl -I http://localhost:8000/api/v1/partner-list
# HTTP/1.1 401 Unauthorized
```

## 次のアクション
1. `/frontend/src/api/businessPartner.ts`のaxiosインスタンス確認
2. `/frontend/src/utils/api.ts`または類似ファイルの認証設定確認  
3. localStorageまたはsessionStorageのトークン保存状況確認
4. 修正後、`_Knowledge`ディレクトリに解決方法を登録