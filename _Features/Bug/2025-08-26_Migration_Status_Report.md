# å–å¼•å…ˆæ©Ÿèƒ½ æ®µéšçš„ç§»è¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ
**æ›´æ–°æ—¥æ™‚**: 2025-08-26 15:10  
**é€²æ—**: 85% å®Œäº†

## å®Ÿæ–½æ¸ˆã¿ä½œæ¥­

### âœ… Phase 1: ç·Šæ€¥å¯¾å¿œï¼ˆå®Œäº†ï¼‰
- [x] å•é¡Œã®èª¿æŸ»ã¨æ–‡æ›¸åŒ–
- [x] æš«å®šå®Ÿè£…ã®ç¶™ç¶šä½¿ç”¨ã‚’æ±ºå®š
- [x] ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æš«å®šå®Ÿè£…ã«æˆ»ã™

### âœ… Phase 2: åŸºç›¤æ•´å‚™ï¼ˆå®Œäº†ï¼‰
- [x] **Prismaã‚¹ã‚­ãƒ¼ãƒã®æ›´æ–°**
  - `BusinessPartnerDetail`ãƒ¢ãƒ‡ãƒ«ã‚’è¿½åŠ 
  - ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ¸ˆã¿ï¼ˆ20250826054416_add_business_partner_detailsï¼‰
  
- [x] **ãƒ‡ãƒ¼ã‚¿å¤‰æ›å±¤ã®å®Ÿè£…**
  - `/backend/src/utils/businessPartnerTransformer.ts`ä½œæˆ
  - Prismaãƒ¢ãƒ‡ãƒ«â‡”æš«å®šå®Ÿè£…å½¢å¼ã®ç›¸äº’å¤‰æ›å¯¾å¿œ
  
- [x] **æ­£å¼APIã‚µãƒ¼ãƒ“ã‚¹ã®æ”¹ä¿®**
  - `/backend/src/services/businessPartnerService2.ts`ä½œæˆ
  - æš«å®šå®Ÿè£…äº’æ›æ€§ã‚’ç¢ºä¿

- [x] **ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
  - `/backend/scripts/migrate-business-partners.ts`ä½œæˆ
  - ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³å®Ÿè¡Œæ¸ˆã¿ï¼ˆ1ä»¶ã®ç§»è¡Œå¯¾è±¡ç¢ºèªï¼‰

### âœ… Phase 3: åˆ‡ã‚Šæ›¿ãˆåŸºç›¤ï¼ˆå®Œäº†ï¼‰
- [x] **Feature Flagå®Ÿè£…**
  - `/backend/src/config/featureFlags.ts`ä½œæˆ
  - ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹åˆ¶å¾¡å®Ÿè£…
  
- [x] **ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼æ”¹ä¿®**
  - `/backend/src/controllers/businessPartnerController2.ts`ä½œæˆ
  - Feature Flagã«ã‚ˆã‚‹æ®µéšçš„åˆ‡ã‚Šæ›¿ãˆå¯¾å¿œ
  
- [x] **ç’°å¢ƒè¨­å®š**
  - `.env.development`ã«Feature Flagè¨­å®šè¿½åŠ 
  - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯`USE_NEW_BP_API=false`ï¼ˆå®‰å…¨å´ï¼‰

## ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

### ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
```
â”œâ”€ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: âœ… æ–°ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆæ¸ˆã¿
â”œâ”€ API: âœ… ä¸¡æ–¹ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¨¼åƒå¯èƒ½
â”œâ”€ Feature Flag: âœ… è¨­å®šæ¸ˆã¿ï¼ˆOFFï¼‰
â””â”€ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: âš ï¸ æš«å®šå®Ÿè£…ã‚’ä½¿ç”¨ä¸­
```

### ç§»è¡Œå¯¾è±¡ãƒ‡ãƒ¼ã‚¿
- **CLIENTä¼æ¥­**: 1ä»¶ï¼ˆæ ªå¼ä¼šç¤¾ABCã‚³ãƒ¼ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
- **ç¨¼åƒã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢**: 0å
- **æœˆé–“å£²ä¸Š**: Â¥0

### âœ… Phase 4: ãƒ‡ãƒ¼ã‚¿ç§»è¡Œã¨åˆæœŸãƒ†ã‚¹ãƒˆï¼ˆå®Œäº†ï¼‰

- [x] **ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**
  - SESä¼æ¥­ï¼ˆID: 5ï¼‰ã‚’ä½œæˆãƒ»ç¢ºèª
  - BusinessPartnerãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆID: 2ï¼‰
  - BusinessPartnerDetailãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
  
- [x] **Feature Flagæœ‰åŠ¹åŒ–**
  - docker-compose.ymlã«ç’°å¢ƒå¤‰æ•°è¿½åŠ 
  - `USE_NEW_BP_API=true`è¨­å®š
  - ã‚³ãƒ³ãƒ†ãƒŠå†èµ·å‹•ã§é©ç”¨ç¢ºèª

- [x] **åˆæœŸå‹•ä½œç¢ºèª**
  - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯API: âœ… æ­£å¸¸
  - æš«å®šå®Ÿè£…API: èªè¨¼å¿…è¦
  - æ–°å®Ÿè£…API: èªè¨¼å¿…è¦ï¼ˆFeature Flagæœ‰åŠ¹ï¼‰

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ğŸ”„ Phase 5: æœ¬æ ¼ãƒ†ã‚¹ãƒˆã¨èª¿æ•´ï¼ˆé€²è¡Œä¸­ï¼‰

#### 1. é–‹ç™ºç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ
```bash
# Feature Flagã‚’æœ‰åŠ¹åŒ–
export USE_NEW_BP_API=true

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å†èµ·å‹•
docker-compose restart backend

# å‹•ä½œç¢ºèª
curl http://localhost:8000/api/business-partners
```

#### 2. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
```bash
# æœ¬ç•ªå®Ÿè¡Œ
npx ts-node scripts/migrate-business-partners.ts migrate

# ç¢ºèª
npx ts-node scripts/migrate-business-partners.ts dry-run
```

#### 3. æ®µéšçš„åˆ‡ã‚Šæ›¿ãˆ
- [ ] èª­ã¿å–ã‚Šå°‚ç”¨ã§æ–°APIã‚’ãƒ†ã‚¹ãƒˆ
- [ ] ç‰¹å®šãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿æ–°APIä½¿ç”¨
- [ ] å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸å±•é–‹

#### 3. å®Ÿè¡Œæ¸ˆã¿ã‚³ãƒãƒ³ãƒ‰å±¥æ­´
```bash
# ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
npx ts-node scripts/migrate-business-partners.ts migrate
# â†’ âœ… 1ä»¶ã®BusinessPartnerä½œæˆæˆåŠŸ

# BusinessPartnerDetailè¿½åŠ 
npx ts-node scripts/add-partner-details.ts
# â†’ âœ… 1ä»¶ã®è©³ç´°ãƒ‡ãƒ¼ã‚¿ä½œæˆæˆåŠŸ

# Feature Flagæœ‰åŠ¹åŒ–
docker-compose restart backend
# â†’ âœ… USE_NEW_BP_API=trueé©ç”¨ç¢ºèª
```

### â³ Phase 6: å®Œå…¨ç§»è¡Œï¼ˆäºˆå®šï¼‰
- [ ] èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã¨APIãƒ†ã‚¹ãƒˆ
- [ ] ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ
- [ ] æš«å®šå®Ÿè£…ã®å‰Šé™¤
- [ ] `/api/v1/partner-list`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆå»ƒæ­¢
- [ ] ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰ã®å‰Šé™¤

## ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ãƒªã‚¹ã‚¯ | ç¾çŠ¶ | å¯¾ç­– |
|--------|------|------|
| ãƒ‡ãƒ¼ã‚¿ä¸æ•´åˆ | ğŸŸ¡ ä¸­ | ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè£…æ¸ˆã¿ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | ğŸŸ¢ ä½ | ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®šæ¸ˆã¿ |
| ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ğŸŸ¢ ä½ | Feature Flagã§å³åº§ã«åˆ‡ã‚Šæˆ»ã—å¯èƒ½ |

## å‹•ä½œç¢ºèªæ‰‹é †

### 1. ç¾åœ¨ã®å‹•ä½œç¢ºèªï¼ˆæš«å®šå®Ÿè£…ï¼‰
```bash
# ç¾çŠ¶ç¢ºèª
curl http://localhost:8000/api/v1/partner-list
```

### 2. æ–°å®Ÿè£…ã®ãƒ†ã‚¹ãƒˆ
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
USE_NEW_BP_API=true

# Dockerå†èµ·å‹•
docker-compose restart backend

# æ–°APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
curl http://localhost:8000/api/business-partners
```

### 3. ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
USE_NEW_BP_API=false

# å…ƒã«æˆ»ã‚‹ã“ã¨ã‚’ç¢ºèª
```

## ç›£è¦–é …ç›®

- **ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°**: `/backend/logs/error.log`
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ç›£è¦–
- **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿æ¤œè¨¼

## å•é¡Œç™ºç”Ÿæ™‚ã®å¯¾å¿œ

1. **å³åº§ã«Feature Flagã‚’OFF**
   ```bash
   USE_NEW_BP_API=false
   docker-compose restart backend
   ```

2. **ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå¿…è¦ãªå ´åˆï¼‰**
   ```bash
   npx ts-node scripts/migrate-business-partners.ts rollback
   ```

3. **ãƒ­ã‚°ç¢ºèª**
   ```bash
   docker logs compactskillsheetsapp-backend-1 --tail 100
   ```

## ã¾ã¨ã‚

æ®µéšçš„ç§»è¡Œã®åŸºç›¤æ§‹ç¯‰ã¯**å®Œäº†**ã—ã¾ã—ãŸã€‚ç¾åœ¨ã¯å®‰å…¨ã®ãŸã‚æš«å®šå®Ÿè£…ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€Feature Flagã®åˆ‡ã‚Šæ›¿ãˆã«ã‚ˆã‚Šã„ã¤ã§ã‚‚æ–°å®Ÿè£…ã«ç§»è¡Œå¯èƒ½ãªçŠ¶æ…‹ã§ã™ã€‚

### é‡è¦ãªæ³¨æ„äº‹é …
- âš ï¸ æœ¬ç•ªç’°å¢ƒã¸ã®é©ç”¨å‰ã«ååˆ†ãªãƒ†ã‚¹ãƒˆãŒå¿…è¦
- âš ï¸ ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¯æ…é‡ã«å®Ÿæ–½
- âš ï¸ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚’ç¶™ç¶š

---
**æ‹…å½“**: ClaudeCode  
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼**: 2025-08-27