# エンドポイント定義書 - エンジニアスキルシート管理システム

## 1. 認証・認可エンドポイント

### 1.1 認証系
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/auth/login` | POST | ログイン | 全員 |
| `/auth/logout` | POST | ログアウト | 認証済み |
| `/auth/register` | POST | ユーザー登録 | 招待済み |
| `/auth/refresh` | POST | トークン更新 | 認証済み |
| `/auth/me` | GET | 現在のユーザー情報取得 | 認証済み |

### 1.2 パスワード管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/auth/password/reset-request` | POST | パスワードリセット要求 | 全員 |
| `/auth/password/reset` | POST | パスワードリセット実行 | トークン保持者 |
| `/auth/password/change` | PUT | パスワード変更 | 認証済み |

### 1.3 多要素認証
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/auth/mfa/setup` | POST | MFA設定開始 | 認証済み |
| `/auth/mfa/verify` | POST | MFA認証 | 認証済み |
| `/auth/mfa/disable` | DELETE | MFA無効化 | 認証済み |
| `/auth/mfa/backup-codes` | GET | バックアップコード取得 | 認証済み |

## 2. ユーザー管理エンドポイント

### 2.1 ユーザーCRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/users` | GET | ユーザー一覧取得 | 管理者・営業 |
| `/users/{userId}` | GET | ユーザー詳細取得 | 管理者・本人 |
| `/users/{userId}` | PUT | ユーザー更新 | 管理者・本人 |
| `/users/{userId}` | DELETE | ユーザー削除 | 管理者 |
| `/users/{userId}/activate` | PATCH | ユーザー有効化 | 管理者 |
| `/users/{userId}/deactivate` | PATCH | ユーザー無効化 | 管理者 |

### 2.2 ロール・権限管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/users/{userId}/roles` | GET | ユーザーロール取得 | 管理者 |
| `/users/{userId}/roles` | PUT | ユーザーロール更新 | 管理者 |
| `/users/{userId}/permissions` | GET | ユーザー権限取得 | 管理者 |
| `/roles` | GET | ロール一覧取得 | 管理者 |
| `/permissions` | GET | 権限一覧取得 | 管理者 |

## 3. エンジニア管理エンドポイント

### 3.1 エンジニアCRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers` | GET | エンジニア一覧取得 | 管理者・営業 |
| `/engineers` | POST | エンジニア作成 | 管理者・営業 |
| `/engineers/{engineerId}` | GET | エンジニア詳細取得 | 管理者・営業・本人 |
| `/engineers/{engineerId}` | PUT | エンジニア更新 | 管理者・営業・本人 |
| `/engineers/{engineerId}` | DELETE | エンジニア削除 | 管理者 |

### 3.2 エンジニアステータス管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/{engineerId}/status` | PATCH | ステータス更新 | 管理者・営業・本人 |
| `/engineers/{engineerId}/availability` | PUT | 稼働可能時期更新 | 管理者・営業・本人 |
| `/engineers/{engineerId}/public` | PATCH | 公開設定変更 | 管理者・営業 |

### 3.3 エンジニア検索・フィルタリング
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/search` | POST | 高度検索 | 管理者・営業・取引先 |
| `/engineers/waiting` | GET | 待機中エンジニア | 管理者・営業・取引先 |
| `/engineers/available` | GET | 稼働可能エンジニア | 管理者・営業・取引先 |
| `/engineers/skills/{skill}` | GET | スキル別エンジニア | 管理者・営業・取引先 |

## 4. スキルシート管理エンドポイント

### 4.1 スキルシートCRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/{engineerId}/skill-sheet` | GET | スキルシート取得 | 管理者・営業・本人・取引先 |
| `/engineers/{engineerId}/skill-sheet` | PUT | スキルシート更新 | 本人・管理者 |
| `/engineers/{engineerId}/skill-sheet` | PATCH | スキルシート部分更新 | 本人・管理者 |
| `/skill-sheets/{sheetId}` | GET | スキルシート直接取得 | 権限による |

### 4.2 スキルシート機能
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/{engineerId}/skill-sheet/export` | GET | PDF/Excel出力 | 管理者・営業・本人 |
| `/engineers/{engineerId}/skill-sheet/preview` | GET | プレビュー | 本人・管理者 |
| `/engineers/{engineerId}/skill-sheet/complete` | PATCH | 入力完了設定 | 本人・管理者 |
| `/engineers/{engineerId}/skill-sheet/template` | GET | テンプレート取得 | 本人・管理者 |

### 4.3 スキル管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/skills/programming-languages` | GET | プログラミング言語一覧 | 全員 |
| `/skills/frameworks` | GET | フレームワーク一覧 | 全員 |
| `/skills/databases` | GET | データベース一覧 | 全員 |
| `/skills/cloud-services` | GET | クラウドサービス一覧 | 全員 |
| `/skills/suggest` | POST | スキル候補提案 | 認証済み |

## 5. プロジェクト管理エンドポイント

### 5.1 プロジェクトCRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/projects` | GET | プロジェクト一覧取得 | 管理者・営業 |
| `/projects` | POST | プロジェクト作成 | 管理者・営業 |
| `/projects/{projectId}` | GET | プロジェクト詳細取得 | 管理者・営業・参画者 |
| `/projects/{projectId}` | PUT | プロジェクト更新 | 管理者・営業 |
| `/projects/{projectId}` | DELETE | プロジェクト削除 | 管理者 |

### 5.2 プロジェクト・エンジニア関連付け
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/projects/{projectId}/engineers` | GET | 参画エンジニア一覧 | 管理者・営業・参画者 |
| `/projects/{projectId}/engineers` | POST | エンジニア追加 | 管理者・営業 |
| `/projects/{projectId}/engineers/{engineerId}` | PUT | 参画情報更新 | 管理者・営業 |
| `/projects/{projectId}/engineers/{engineerId}` | DELETE | エンジニア除外 | 管理者・営業 |

### 5.3 エンジニア別プロジェクト
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/{engineerId}/projects` | GET | 参画プロジェクト一覧 | 管理者・営業・本人 |
| `/engineers/{engineerId}/projects/current` | GET | 現在のプロジェクト | 管理者・営業・本人 |
| `/engineers/{engineerId}/projects/history` | GET | プロジェクト履歴 | 管理者・営業・本人 |

## 6. アプローチ・営業管理エンドポイント

### 6.1 アプローチCRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/approaches` | GET | アプローチ履歴取得 | 管理者・営業 |
| `/approaches` | POST | アプローチ送信 | 管理者・営業 |
| `/approaches/{approachId}` | GET | アプローチ詳細取得 | 管理者・営業 |
| `/approaches/{approachId}` | PUT | アプローチ更新 | 管理者・営業 |
| `/approaches/{approachId}` | DELETE | アプローチ削除 | 管理者・営業 |

### 6.2 定期アプローチ管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/approaches/periodic` | GET | 定期設定一覧 | 管理者・営業 |
| `/approaches/periodic` | POST | 定期設定作成 | 管理者・営業 |
| `/approaches/periodic/{id}` | PUT | 定期設定更新 | 管理者・営業 |
| `/approaches/periodic/{id}` | DELETE | 定期設定削除 | 管理者・営業 |
| `/approaches/periodic/{id}/pause` | PATCH | 定期配信停止 | 管理者・営業 |

### 6.3 メールテンプレート管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/approaches/templates` | GET | テンプレート一覧 | 管理者・営業 |
| `/approaches/templates` | POST | テンプレート作成 | 管理者・営業 |
| `/approaches/templates/{templateId}` | PUT | テンプレート更新 | 管理者・営業 |
| `/approaches/templates/{templateId}` | DELETE | テンプレート削除 | 管理者・営業 |
| `/approaches/templates/{templateId}/preview` | GET | プレビュー | 管理者・営業 |

## 7. 取引先管理エンドポイント

### 7.1 取引先企業管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/business-partners` | GET | 取引先一覧取得 | 管理者・営業 |
| `/business-partners` | POST | 取引先追加 | 管理者・営業 |
| `/business-partners/{partnerId}` | GET | 取引先詳細取得 | 管理者・営業 |
| `/business-partners/{partnerId}` | PUT | 取引先更新 | 管理者・営業 |
| `/business-partners/{partnerId}` | DELETE | 取引先削除 | 管理者・営業 |

### 7.2 アクセス制御管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/business-partners/{partnerId}/access-url` | POST | アクセスURL生成 | 管理者・営業 |
| `/business-partners/{partnerId}/access-url` | PUT | アクセスURL更新 | 管理者・営業 |
| `/business-partners/{partnerId}/permissions` | GET | 権限設定取得 | 管理者・営業 |
| `/business-partners/{partnerId}/permissions` | PUT | 権限設定更新 | 管理者・営業 |
| `/business-partners/{partnerId}/engineers` | PUT | 公開エンジニア設定 | 管理者・営業 |

### 7.3 アクセス履歴・分析
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/business-partners/{partnerId}/activity` | GET | アクセス履歴 | 管理者・営業 |
| `/business-partners/{partnerId}/analytics` | GET | 利用分析 | 管理者・営業 |
| `/business-partners/{partnerId}/engagement` | GET | エンゲージメント | 管理者・営業 |

## 8. 検索・フィルタリングエンドポイント

### 8.1 高度検索
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/search/engineers` | POST | エンジニア検索 | 管理者・営業・取引先 |
| `/search/projects` | POST | プロジェクト検索 | 管理者・営業 |
| `/search/approaches` | POST | アプローチ検索 | 管理者・営業 |
| `/search/global` | POST | 全体検索 | 管理者・営業 |

### 8.2 保存済み検索
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/search/saved` | GET | 保存済み検索一覧 | 認証済み |
| `/search/saved` | POST | 検索条件保存 | 認証済み |
| `/search/saved/{searchId}` | GET | 保存済み検索実行 | 認証済み |
| `/search/saved/{searchId}` | PUT | 保存済み検索更新 | 認証済み |
| `/search/saved/{searchId}` | DELETE | 保存済み検索削除 | 認証済み |

### 8.3 検索支援
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/search/suggestions` | GET | 検索候補取得 | 認証済み |
| `/search/autocomplete` | GET | オートコンプリート | 認証済み |
| `/search/filters` | GET | 利用可能フィルター | 認証済み |
| `/search/popular` | GET | 人気検索条件 | 認証済み |

## 9. 通知管理エンドポイント

### 9.1 通知CRUD
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/notifications` | GET | 通知一覧取得 | 認証済み |
| `/notifications` | POST | 通知作成 | 管理者・営業 |
| `/notifications/{notificationId}` | GET | 通知詳細取得 | 認証済み |
| `/notifications/{notificationId}` | PATCH | 既読設定 | 認証済み |
| `/notifications/{notificationId}` | DELETE | 通知削除 | 認証済み |

### 9.2 通知設定
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/notifications/settings` | GET | 通知設定取得 | 認証済み |
| `/notifications/settings` | PUT | 通知設定更新 | 認証済み |
| `/notifications/settings/reset` | POST | 設定リセット | 認証済み |

### 9.3 一括操作
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/notifications/mark-all-read` | PATCH | 全既読設定 | 認証済み |
| `/notifications/clear-read` | DELETE | 既読通知削除 | 認証済み |
| `/notifications/unread-count` | GET | 未読件数取得 | 認証済み |

## 10. ファイル管理エンドポイント

### 10.1 ファイル操作
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/files/upload` | POST | ファイルアップロード | 認証済み |
| `/files/{fileId}` | GET | ファイル取得 | 権限による |
| `/files/{fileId}` | DELETE | ファイル削除 | 権限による |
| `/files/{fileId}/metadata` | GET | ファイル情報取得 | 権限による |

### 10.2 プロフィール画像
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/engineers/{engineerId}/profile-image` | POST | プロフィール画像アップロード | 本人・管理者 |
| `/engineers/{engineerId}/profile-image` | GET | プロフィール画像取得 | 権限による |
| `/engineers/{engineerId}/profile-image` | DELETE | プロフィール画像削除 | 本人・管理者 |

### 10.3 エクスポート機能
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/export/engineers` | POST | エンジニア一覧CSV出力 | 管理者・営業 |
| `/export/skill-sheets` | POST | スキルシート一括出力 | 管理者・営業 |
| `/export/approaches` | POST | アプローチ履歴出力 | 管理者・営業 |
| `/export/projects` | POST | プロジェクト一覧出力 | 管理者・営業 |

## 11. 管理者エンドポイント

### 11.1 企業管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/companies` | GET | 企業一覧取得 | 管理者 |
| `/admin/companies` | POST | 企業作成 | 管理者 |
| `/admin/companies/{companyId}` | GET | 企業詳細取得 | 管理者 |
| `/admin/companies/{companyId}` | PUT | 企業更新 | 管理者 |
| `/admin/companies/{companyId}` | DELETE | 企業削除 | 管理者 |
| `/admin/companies/{companyId}/lock` | PATCH | 企業ロック | 管理者 |
| `/admin/companies/{companyId}/unlock` | PATCH | 企業ロック解除 | 管理者 |

### 11.2 契約管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/contracts` | GET | 契約一覧取得 | 管理者 |
| `/admin/contracts` | POST | 契約作成 | 管理者 |
| `/admin/contracts/{contractId}` | GET | 契約詳細取得 | 管理者 |
| `/admin/contracts/{contractId}` | PUT | 契約更新 | 管理者 |
| `/admin/contract-plans` | GET | 契約プラン一覧 | 管理者 |
| `/admin/contract-plans` | POST | 契約プラン作成 | 管理者 |

### 11.3 請求・売上管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/invoices` | GET | 請求書一覧取得 | 管理者 |
| `/admin/invoices/generate` | POST | 請求書一括生成 | 管理者 |
| `/admin/invoices/{invoiceId}` | GET | 請求書詳細取得 | 管理者 |
| `/admin/payments` | GET | 入金一覧取得 | 管理者 |
| `/admin/payments` | POST | 入金記録 | 管理者 |
| `/admin/revenue/analytics` | GET | 売上分析 | 管理者 |

### 11.4 利用統計・監視
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/usage/statistics` | GET | 利用統計取得 | 管理者 |
| `/admin/usage/companies/{companyId}` | GET | 企業別利用統計 | 管理者 |
| `/admin/system/health` | GET | システムヘルス | 管理者 |
| `/admin/system/metrics` | GET | システムメトリクス | 管理者 |
| `/admin/audit-logs` | GET | 監査ログ取得 | 管理者 |

## 12. サポート・運営エンドポイント

### 12.1 サポート管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/support/tickets` | GET | チケット一覧取得 | 管理者 |
| `/admin/support/tickets` | POST | チケット作成 | 管理者 |
| `/admin/support/tickets/{ticketId}` | GET | チケット詳細取得 | 管理者 |
| `/admin/support/tickets/{ticketId}` | PUT | チケット更新 | 管理者 |
| `/admin/support/tickets/{ticketId}/assign` | PATCH | 担当者アサイン | 管理者 |
| `/admin/support/tickets/{ticketId}/close` | PATCH | チケットクローズ | 管理者 |

### 12.2 メンテナンス管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/maintenance/schedules` | GET | メンテナンス予定一覧 | 管理者 |
| `/admin/maintenance/schedules` | POST | メンテナンス計画作成 | 管理者 |
| `/admin/maintenance/{scheduleId}` | PUT | メンテナンス計画更新 | 管理者 |
| `/admin/maintenance/{scheduleId}/execute` | POST | メンテナンス実行 | 管理者 |
| `/admin/maintenance/{scheduleId}/complete` | PATCH | メンテナンス完了 | 管理者 |
| `/admin/maintenance/history` | GET | メンテナンス履歴 | 管理者 |

### 12.3 お知らせ管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/announcements` | GET | お知らせ一覧取得 | 管理者 |
| `/admin/announcements` | POST | お知らせ作成 | 管理者 |
| `/admin/announcements/{announcementId}` | PUT | お知らせ更新 | 管理者 |
| `/admin/announcements/{announcementId}/publish` | PATCH | お知らせ公開 | 管理者 |
| `/admin/announcements/{announcementId}/unpublish` | PATCH | お知らせ非公開 | 管理者 |
| `/admin/announcements/{announcementId}/analytics` | GET | お知らせ効果測定 | 管理者 |

### 12.4 セキュリティ管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/security/threats` | GET | 脅威検知状況 | 管理者 |
| `/admin/security/incidents` | GET | インシデント一覧 | 管理者 |
| `/admin/security/incidents` | POST | インシデント作成 | 管理者 |
| `/admin/security/ip-blocks` | GET | IP制限一覧 | 管理者 |
| `/admin/security/ip-blocks` | POST | IP制限設定 | 管理者 |
| `/admin/security/vulnerability-scan` | POST | 脆弱性スキャン実行 | 管理者 |

### 12.5 機能制御管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/admin/features` | GET | 機能フラグ一覧 | 管理者 |
| `/admin/features/{featureName}` | PUT | 機能制御設定 | 管理者 |
| `/admin/features/ab-tests` | GET | A/Bテスト一覧 | 管理者 |
| `/admin/features/ab-tests` | POST | A/Bテスト作成 | 管理者 |
| `/admin/features/rollout/{featureName}` | POST | 段階的ロールアウト開始 | 管理者 |
| `/admin/features/emergency-stop/{featureName}` | POST | 緊急機能停止 | 管理者 |

## 13. システム・ヘルス管理エンドポイント

### 13.1 ヘルスチェック
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/health` | GET | 基本ヘルスチェック | 全員 |
| `/health/detailed` | GET | 詳細ヘルスチェック | 管理者 |
| `/health/database` | GET | データベース状態 | 管理者 |
| `/health/redis` | GET | キャッシュ状態 | 管理者 |
| `/health/external-services` | GET | 外部サービス状態 | 管理者 |

### 13.2 メトリクス
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/metrics` | GET | Prometheusメトリクス | 監視システム |
| `/metrics/business` | GET | ビジネスメトリクス | 管理者 |
| `/metrics/performance` | GET | パフォーマンスメトリクス | 管理者 |

### 13.3 システム情報
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/version` | GET | バージョン情報 | 全員 |
| `/system/info` | GET | システム情報 | 管理者 |
| `/system/config` | GET | 設定情報 | 管理者 |

## 14. 取引先向けエンドポイント

### 14.1 取引先ダッシュボード
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/client/dashboard` | GET | ダッシュボード情報 | 取引先 |
| `/client/engineers/available` | GET | 利用可能エンジニア | 取引先 |
| `/client/engineers/{engineerId}` | GET | エンジニア詳細 | 取引先 |
| `/client/search/engineers` | POST | エンジニア検索 | 取引先 |

### 14.2 アサイン依頼
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/client/assign-requests` | GET | アサイン依頼一覧 | 取引先 |
| `/client/assign-requests` | POST | アサイン依頼作成 | 取引先 |
| `/client/assign-requests/{requestId}` | GET | アサイン依頼詳細 | 取引先 |
| `/client/assign-requests/{requestId}` | PUT | アサイン依頼更新 | 取引先 |

## 15. フリーランス向けエンドポイント

### 15.1 フリーランス管理
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/freelancers/register` | POST | フリーランス登録 | 全員 |
| `/freelancers/{freelancerId}` | GET | フリーランス詳細 | 本人・管理者・営業 |
| `/freelancers/{freelancerId}` | PUT | フリーランス更新 | 本人・管理者 |
| `/freelancers/{freelancerId}/public` | PATCH | 公開設定変更 | 本人 |

### 15.2 フリーランス向け機能
| エンドポイント | メソッド | 概要 | 権限 |
|----------------|----------|------|------|
| `/freelancers/{freelancerId}/approaches` | GET | 受信アプローチ一覧 | 本人 |
| `/freelancers/{freelancerId}/rate` | PUT | 単価設定更新 | 本人 |
| `/freelancers/{freelancerId}/availability` | PUT | 稼働可能時期更新 | 本人 |

このエンドポイント定義書により、各機能への明確なアクセス方法と権限設定が定義され、効率的な開発とAPIの適切な利用が可能になります。