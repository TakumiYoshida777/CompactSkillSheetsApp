# å®Ÿè£…ç’°å¢ƒãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆè¨­è¨ˆæ›¸ - ã•ãã‚‰VPSå¯¾å¿œç‰ˆ

## 1. ç’°å¢ƒæ§‹æˆæ¦‚è¦

### 1.1 ç’°å¢ƒåˆ†é¡ž
| ç’°å¢ƒ | ç›®çš„ | URLä¾‹ | åˆ©ç”¨è€… | ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ |
|------|------|-------|--------|------------|
| é–‹ç™ºç’°å¢ƒ (Development) | é–‹ç™ºãƒ»å˜ä½“ãƒ†ã‚¹ãƒˆ | http://localhost:3000 | é–‹ç™ºè€… | ãƒ­ãƒ¼ã‚«ãƒ«Docker |
| ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ (Staging) | çµåˆãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼ | https://staging.skillsheet.example.com | é–‹ç™ºè€…ãƒ»QAãƒ»é¡§å®¢ | ã•ãã‚‰VPSï¼ˆ2GBï¼‰ |
| æœ¬ç•ªç’°å¢ƒ (Production) | å®Ÿéš›ã®ã‚µãƒ¼ãƒ“ã‚¹æä¾› | https://skillsheet.example.com | ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ã•ãã‚‰VPSï¼ˆ4GBÃ—2ï¼‰ |
| ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç’°å¢ƒ (Backup) | ç½å®³å¾©æ—§ç”¨ | - | ã‚·ã‚¹ãƒ†ãƒ  | ã•ãã‚‰VPSï¼ˆ2GBï¼‰ |

### 1.2 ã•ãã‚‰VPSã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ
```
æœ¬ç•ªç’°å¢ƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆã•ãã‚‰VPSï¼‰:

[ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ]
      â”‚
[ã•ãã‚‰ã®DNS/CDN]
      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ (Nginx)        â”‚
â”‚  - SSLçµ‚ç«¯ (Let's Encrypt)         â”‚
â”‚  - ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·                 â”‚
â”‚  - è² è·åˆ†æ•£                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VPSã‚µãƒ¼ãƒãƒ¼1 â”‚    â”‚  VPSã‚µãƒ¼ãƒãƒ¼2 â”‚
â”‚  (4GB RAM)   â”‚    â”‚  (4GB RAM)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dockeræ§‹æˆ:   â”‚    â”‚ Dockeræ§‹æˆ:   â”‚
â”‚ - Frontend   â”‚    â”‚ - Frontend   â”‚
â”‚ - Backend    â”‚    â”‚ - Backend    â”‚
â”‚ - Worker     â”‚    â”‚ - Worker     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   å…±æœ‰ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹     â”‚
    â”‚  - PostgreSQL 15     â”‚
    â”‚  - Redis 7          â”‚
    â”‚  - Elasticsearch 8   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ â”‚
    â”‚  (ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰)   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. é–‹ç™ºç’°å¢ƒè¨­è¨ˆï¼ˆãƒ­ãƒ¼ã‚«ãƒ«Dockerï¼‰

### 2.1 é–‹ç™ºç”¨Docker Composeè¨­å®š

#### docker-compose.yml
```yaml
version: '3.8'

services:
  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆReactï¼‰
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      - REACT_APP_API_URL=http://localhost:8000/api/v1
      - REACT_APP_WS_URL=ws://localhost:8000
      - CHOKIDAR_USEPOLLING=true
    depends_on:
      - backend
    networks:
      - skillsheet-dev

  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆNode.jsï¼‰
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    ports:
      - "8000:8000"
      - "9229:9229"  # ãƒ‡ãƒãƒƒã‚¬ãƒ¼
    volumes:
      - ./backend:/app
      - /app/node_modules
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgresql://skillsheet:password@postgres:5432/skillsheet_dev
      - REDIS_URL=redis://redis:6379
      - JWT_SECRET=dev-jwt-secret
      - CORS_ORIGIN=http://localhost:3000
    depends_on:
      - postgres
      - redis
    networks:
      - skillsheet-dev

  # PostgreSQL
  postgres:
    image: postgres:15-alpine
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_USER=skillsheet
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=skillsheet_dev
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - skillsheet-dev

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    networks:
      - skillsheet-dev

  # Elasticsearch
  elasticsearch:
    image: elasticsearch:8.11.0
    ports:
      - "9200:9200"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
    volumes:
      - es_data:/usr/share/elasticsearch/data
    networks:
      - skillsheet-dev

volumes:
  postgres_data:
  redis_data:
  es_data:

networks:
  skillsheet-dev:
    driver: bridge
```

### 2.2 é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### scripts/setup-dev.sh
```bash
#!/bin/bash

echo "ðŸš€ é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—é–‹å§‹"

# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ
create_env_files() {
    echo "ðŸ“ ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆä¸­..."
    
    cat > .env.development << EOF
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
NODE_ENV=development
PORT=8000

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
DATABASE_URL=postgresql://skillsheet:password@postgres:5432/skillsheet_dev

# Redisè¨­å®š
REDIS_URL=redis://redis:6379

# JWTè¨­å®š
JWT_SECRET=dev-jwt-secret-change-in-production

# æš—å·åŒ–ã‚­ãƒ¼
ENCRYPTION_KEY=dev-encryption-key-32-characters

# CORSè¨­å®š
CORS_ORIGIN=http://localhost:3000

# Elasticsearch
ELASTICSEARCH_URL=http://elasticsearch:9200
EOF

    echo "âœ… ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã—ãŸ"
}

# Dockerã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•
start_docker() {
    echo "ðŸ³ Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•ä¸­..."
    
    # æ—¢å­˜ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
    docker-compose down
    
    # ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
    docker-compose build
    
    # ã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
    docker-compose up -d
    
    echo "â³ ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•ã‚’å¾…æ©Ÿä¸­..."
    sleep 15
    
    echo "âœ… Dockerã‚³ãƒ³ãƒ†ãƒŠãŒèµ·å‹•ã—ã¾ã—ãŸ"
}

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–
init_database() {
    echo "ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ä¸­..."
    
    # ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    docker-compose exec backend npm run migrate:dev
    
    # ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
    docker-compose exec backend npm run seed:dev
    
    echo "âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ"
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    create_env_files
    start_docker
    init_database
    
    echo "ðŸŽ‰ é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
    echo ""
    echo "ðŸ“‹ ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±:"
    echo "  ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: http://localhost:3000"
    echo "  ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API: http://localhost:8000"
    echo "  PostgreSQL: localhost:5432"
    echo "  Redis: localhost:6379"
    echo "  Elasticsearch: http://localhost:9200"
}

main
```

## 3. ã•ãã‚‰VPSç’°å¢ƒæ§‹ç¯‰

### 3.1 VPSã‚µãƒ¼ãƒãƒ¼åˆæœŸè¨­å®š

#### scripts/init-vps.sh
```bash
#!/bin/bash

echo "ðŸš€ ã•ãã‚‰VPSåˆæœŸè¨­å®šé–‹å§‹"

# ã‚·ã‚¹ãƒ†ãƒ ã®æ›´æ–°
update_system() {
    echo "ðŸ“¦ ã‚·ã‚¹ãƒ†ãƒ ã‚’æ›´æ–°ä¸­..."
    apt update && apt upgrade -y
    apt install -y \
        curl \
        git \
        vim \
        htop \
        ufw \
        fail2ban \
        certbot \
        python3-certbot-nginx
}

# Dockerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
install_docker() {
    echo "ðŸ³ Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸­..."
    
    # Dockerã®å…¬å¼ãƒªãƒã‚¸ãƒˆãƒªã‚’è¿½åŠ 
    curl -fsSL https://download.docker.com/linux/ubuntu/gpg | apt-key add -
    add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable"
    
    # Dockerã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    apt update
    apt install -y docker-ce docker-ce-cli containerd.io docker-compose
    
    # Dockerã‚µãƒ¼ãƒ“ã‚¹ã‚’æœ‰åŠ¹åŒ–
    systemctl enable docker
    systemctl start docker
}

# ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã®è¨­å®š
setup_firewall() {
    echo "ðŸ”¥ ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’è¨­å®šä¸­..."
    
    # åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«
    ufw default deny incoming
    ufw default allow outgoing
    
    # å¿…è¦ãªãƒãƒ¼ãƒˆã‚’é–‹æ”¾
    ufw allow 22/tcp    # SSH
    ufw allow 80/tcp    # HTTP
    ufw allow 443/tcp   # HTTPS
    
    # ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã‚’æœ‰åŠ¹åŒ–
    ufw --force enable
}

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ
create_user() {
    echo "ðŸ‘¤ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆä¸­..."
    
    # skillsheetãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
    useradd -m -s /bin/bash skillsheet
    usermod -aG docker skillsheet
    
    # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã‚’ä½œæˆ
    mkdir -p /home/skillsheet/{app,logs,backups,scripts}
    chown -R skillsheet:skillsheet /home/skillsheet
}

# Nginxã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š
setup_nginx() {
    echo "ðŸŒ Nginxã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸­..."
    
    apt install -y nginx
    
    # Nginxè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
    cat > /etc/nginx/sites-available/skillsheet << 'EOF'
upstream backend {
    server 127.0.0.1:8000;
    server 127.0.0.1:8001 backup;
}

server {
    listen 80;
    server_name skillsheet.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name skillsheet.example.com;

    ssl_certificate /etc/letsencrypt/live/skillsheet.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/skillsheet.example.com/privkey.pem;

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # APIãƒ—ãƒ­ã‚­ã‚·
    location /api {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
    location / {
        root /home/skillsheet/app/frontend/dist;
        try_files $uri $uri/ /index.html;
    }
}
EOF

    # è¨­å®šã‚’æœ‰åŠ¹åŒ–
    ln -s /etc/nginx/sites-available/skillsheet /etc/nginx/sites-enabled/
    nginx -t && systemctl restart nginx
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    update_system
    install_docker
    setup_firewall
    create_user
    setup_nginx
    
    echo "âœ… ã•ãã‚‰VPSã®åˆæœŸè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ"
}

main
```

### 3.2 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### scripts/deploy.sh
```bash
#!/bin/bash

set -e

DEPLOY_USER="skillsheet"
DEPLOY_DIR="/home/skillsheet/app"
BACKUP_DIR="/home/skillsheet/backups"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "ðŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤é–‹å§‹: $TIMESTAMP"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®ä½œæˆ
backup_current() {
    echo "ðŸ’¾ ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
    
    if [ -d "$DEPLOY_DIR" ]; then
        tar -czf "$BACKUP_DIR/backup_$TIMESTAMP.tar.gz" -C "$DEPLOY_DIR" .
        echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: backup_$TIMESTAMP.tar.gz"
    fi
}

# æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã®ãƒ‡ãƒ—ãƒ­ã‚¤
deploy_code() {
    echo "ðŸ“¦ æ–°ã—ã„ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
    
    # GitHubã‹ã‚‰æœ€æ–°ã®ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—
    cd $DEPLOY_DIR
    git pull origin main
    
    # ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    cd $DEPLOY_DIR/backend && npm ci --production
    cd $DEPLOY_DIR/frontend && npm ci && npm run build
}

# Dockerã‚³ãƒ³ãƒ†ãƒŠã®æ›´æ–°
update_containers() {
    echo "ðŸ³ Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’æ›´æ–°ä¸­..."
    
    cd $DEPLOY_DIR
    
    # æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰
    docker-compose -f docker-compose.prod.yml build
    
    # Blue-Greenãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
    docker-compose -f docker-compose.prod.yml up -d --no-deps --scale backend=2 backend-new
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    echo "ðŸ¥ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œä¸­..."
    sleep 10
    
    if curl -f http://localhost:8001/health; then
        echo "âœ… æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸ"
        
        # å¤ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢
        docker-compose -f docker-compose.prod.yml stop backend
        docker-compose -f docker-compose.prod.yml rm -f backend
        
        # æ–°ã—ã„ã‚³ãƒ³ãƒ†ãƒŠã‚’backendã«ãƒªãƒãƒ¼ãƒ 
        docker-compose -f docker-compose.prod.yml up -d --no-deps backend
    else
        echo "âŒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—ã€‚ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ä¸­..."
        docker-compose -f docker-compose.prod.yml stop backend-new
        docker-compose -f docker-compose.prod.yml rm -f backend-new
        exit 1
    fi
}

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
run_migrations() {
    echo "ðŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œä¸­..."
    
    docker-compose -f docker-compose.prod.yml exec backend npm run migrate:prod
}

# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
clear_cache() {
    echo "ðŸ§¹ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ä¸­..."
    
    docker-compose -f docker-compose.prod.yml exec redis redis-cli FLUSHDB
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    backup_current
    deploy_code
    update_containers
    run_migrations
    clear_cache
    
    echo "âœ… ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
}

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’skillsheetã«åˆ‡ã‚Šæ›¿ãˆã¦å®Ÿè¡Œ
if [ "$USER" != "$DEPLOY_USER" ]; then
    sudo -u $DEPLOY_USER $0 "$@"
else
    main
fi
```

### 3.3 æœ¬ç•ªç’°å¢ƒç”¨Docker Composeè¨­å®š

#### docker-compose.prod.yml
```yaml
version: '3.8'

services:
  # Nginxï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼‰
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./frontend/dist:/usr/share/nginx/html:ro
      - /etc/letsencrypt:/etc/letsencrypt:ro
    depends_on:
      - backend
    restart: always

  # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.prod
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://skillsheet:${DB_PASSWORD}@postgres:5432/skillsheet_prod
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
      - JWT_SECRET=${JWT_SECRET}
      - ENCRYPTION_KEY=${ENCRYPTION_KEY}
    depends_on:
      - postgres
      - redis
    restart: always
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # ãƒ¯ãƒ¼ã‚«ãƒ¼
  worker:
    build:
      context: ./backend
      dockerfile: Dockerfile.prod
    command: npm run worker
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://skillsheet:${DB_PASSWORD}@postgres:5432/skillsheet_prod
      - REDIS_URL=redis://:${REDIS_PASSWORD}@redis:6379
    depends_on:
      - postgres
      - redis
    restart: always

  # PostgreSQL
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_USER=skillsheet
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=skillsheet_prod
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups/postgres:/backups
    restart: always

  # Redis
  redis:
    image: redis:7-alpine
    command: redis-server --requirepass ${REDIS_PASSWORD}
    volumes:
      - redis_data:/data
    restart: always

  # Elasticsearch
  elasticsearch:
    image: elasticsearch:8.11.0
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=true
      - ELASTIC_PASSWORD=${ELASTIC_PASSWORD}
    volumes:
      - es_data:/usr/share/elasticsearch/data
    restart: always

volumes:
  postgres_data:
  redis_data:
  es_data:
```

## 4. CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆGitHub Actionsï¼‰

### 4.1 CI/CDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

#### .github/workflows/deploy.yml
```yaml
name: Deploy to Sakura VPS

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

env:
  NODE_VERSION: '18'

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: ${{ env.NODE_VERSION }}
        cache: 'npm'
    
    - name: Install dependencies
      run: |
        cd backend && npm ci
        cd ../frontend && npm ci
    
    - name: Run tests
      run: |
        cd backend && npm test
        cd ../frontend && npm test
    
    - name: Build
      run: |
        cd backend && npm run build
        cd ../frontend && npm run build

  deploy-staging:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Staging
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.STAGING_HOST }}
        username: ${{ secrets.STAGING_USER }}
        key: ${{ secrets.STAGING_SSH_KEY }}
        script: |
          cd /home/skillsheet/app
          git pull origin develop
          ./scripts/deploy.sh

  deploy-production:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Production
      uses: appleboy/ssh-action@v0.1.5
      with:
        host: ${{ secrets.PRODUCTION_HOST }}
        username: ${{ secrets.PRODUCTION_USER }}
        key: ${{ secrets.PRODUCTION_SSH_KEY }}
        script: |
          cd /home/skillsheet/app
          git pull origin main
          ./scripts/deploy.sh
    
    - name: Notify Slack
      if: always()
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: 'Production deployment ${{ job.status }}'
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK }}
```

## 5. ç›£è¦–ãƒ»ãƒ­ã‚°ç®¡ç†

### 5.1 ç›£è¦–è¨­å®š

#### monitoring/docker-compose.monitoring.yml
```yaml
version: '3.8'

services:
  # Prometheus
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
      - prometheus_data:/prometheus
    command:
      - '--config.file=/etc/prometheus/prometheus.yml'
      - '--storage.tsdb.path=/prometheus'
    restart: always

  # Grafana
  grafana:
    image: grafana/grafana:latest
    ports:
      - "3030:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}
    volumes:
      - grafana_data:/var/lib/grafana
      - ./grafana/dashboards:/etc/grafana/provisioning/dashboards:ro
    depends_on:
      - prometheus
    restart: always

  # Node Exporter
  node-exporter:
    image: prom/node-exporter:latest
    ports:
      - "9100:9100"
    volumes:
      - /proc:/host/proc:ro
      - /sys:/host/sys:ro
      - /:/rootfs:ro
    command:
      - '--path.procfs=/host/proc'
      - '--path.sysfs=/host/sys'
      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'
    restart: always

  # Lokiï¼ˆãƒ­ã‚°åŽé›†ï¼‰
  loki:
    image: grafana/loki:latest
    ports:
      - "3100:3100"
    volumes:
      - loki_data:/loki
    restart: always

  # Promtailï¼ˆãƒ­ã‚°è»¢é€ï¼‰
  promtail:
    image: grafana/promtail:latest
    volumes:
      - /var/log:/var/log:ro
      - ./promtail.yml:/etc/promtail/promtail.yml:ro
    command: -config.file=/etc/promtail/promtail.yml
    restart: always

volumes:
  prometheus_data:
  grafana_data:
  loki_data:
```

### 5.2 ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### scripts/backup.sh
```bash
#!/bin/bash

BACKUP_DIR="/home/skillsheet/backups"
DATE=$(date +%Y%m%d_%H%M%S)
RETENTION_DAYS=30

echo "ðŸ”„ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹: $DATE"

# PostgreSQLãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
backup_postgres() {
    echo "ðŸ“Š PostgreSQLã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
    
    docker-compose -f docker-compose.prod.yml exec -T postgres \
        pg_dump -U skillsheet skillsheet_prod | \
        gzip > "$BACKUP_DIR/postgres/db_backup_$DATE.sql.gz"
}

# Redisãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
backup_redis() {
    echo "ðŸ’¾ Redisã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
    
    docker-compose -f docker-compose.prod.yml exec -T redis \
        redis-cli --rdb "$BACKUP_DIR/redis/dump_$DATE.rdb" BGSAVE
}

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
backup_uploads() {
    echo "ðŸ“ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
    
    tar -czf "$BACKUP_DIR/uploads/uploads_$DATE.tar.gz" \
        -C /home/skillsheet/app/uploads .
}

# å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã®å‰Šé™¤
cleanup_old_backups() {
    echo "ðŸ§¹ å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å‰Šé™¤ä¸­..."
    
    find $BACKUP_DIR -name "*.gz" -mtime +$RETENTION_DAYS -delete
    find $BACKUP_DIR -name "*.rdb" -mtime +$RETENTION_DAYS -delete
}

# ã•ãã‚‰ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
upload_to_storage() {
    echo "â˜ï¸ ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­..."
    
    # s3cmdã‚’ä½¿ç”¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
    s3cmd put "$BACKUP_DIR/postgres/db_backup_$DATE.sql.gz" \
        s3://skillsheet-backups/postgres/
    
    s3cmd put "$BACKUP_DIR/uploads/uploads_$DATE.tar.gz" \
        s3://skillsheet-backups/uploads/
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    backup_postgres
    backup_redis
    backup_uploads
    upload_to_storage
    cleanup_old_backups
    
    echo "âœ… ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: $DATE"
}

main
```

## 6. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### 6.1 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### scripts/security-hardening.sh
```bash
#!/bin/bash

echo "ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–è¨­å®šã‚’é©ç”¨ä¸­..."

# SSHè¨­å®šã®å¼·åŒ–
harden_ssh() {
    echo "ðŸ” SSHè¨­å®šã‚’å¼·åŒ–ä¸­..."
    
    # SSHDã®è¨­å®šã‚’æ›´æ–°
    cat >> /etc/ssh/sshd_config << EOF
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–è¨­å®š
PermitRootLogin no
PasswordAuthentication no
PubkeyAuthentication yes
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2
AllowUsers skillsheet
EOF

    systemctl restart sshd
}

# Fail2banã®è¨­å®š
setup_fail2ban() {
    echo "ðŸ›¡ï¸ Fail2banã‚’è¨­å®šä¸­..."
    
    cat > /etc/fail2ban/jail.local << EOF
[DEFAULT]
bantime = 3600
findtime = 600
maxretry = 5

[sshd]
enabled = true

[nginx-http-auth]
enabled = true

[nginx-limit-req]
enabled = true
EOF

    systemctl enable fail2ban
    systemctl restart fail2ban
}

# ã‚·ã‚¹ãƒ†ãƒ ã®ç›£æŸ»è¨­å®š
setup_auditd() {
    echo "ðŸ“ ç›£æŸ»ãƒ­ã‚°ã‚’è¨­å®šä¸­..."
    
    apt install -y auditd
    
    # ç›£æŸ»ãƒ«ãƒ¼ãƒ«ã‚’è¿½åŠ 
    cat >> /etc/audit/rules.d/audit.rules << EOF
# ãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ç›£è¦–
-w /etc/passwd -p wa -k passwd_changes
-w /etc/shadow -p wa -k shadow_changes
-w /etc/sudoers -p wa -k sudoers_changes

# ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«ç›£è¦–
-a always,exit -F arch=b64 -S execve -k exec_commands
EOF

    systemctl enable auditd
    systemctl restart auditd
}

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«
setup_modsecurity() {
    echo "ðŸ”¥ ModSecurityã‚’è¨­å®šä¸­..."
    
    apt install -y libapache2-mod-security2
    
    # OWASP CRSã‚’æœ‰åŠ¹åŒ–
    git clone https://github.com/coreruleset/coreruleset.git /etc/modsecurity/
    cp /etc/modsecurity/coreruleset/crs-setup.conf.example /etc/modsecurity/coreruleset/crs-setup.conf
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
main() {
    harden_ssh
    setup_fail2ban
    setup_auditd
    setup_modsecurity
    
    echo "âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ"
}

main
```

## 7. éšœå®³å¯¾å¿œãƒ»å¾©æ—§æ‰‹é †

### 7.1 ç·Šæ€¥æ™‚å¯¾å¿œã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### scripts/emergency-response.sh
```bash
#!/bin/bash

echo "ðŸš¨ ç·Šæ€¥å¯¾å¿œãƒ¢ãƒ¼ãƒ‰"

# ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª
check_services() {
    echo "ðŸ” ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ã‚’ç¢ºèªä¸­..."
    
    docker-compose -f docker-compose.prod.yml ps
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    curl -f http://localhost:8000/health || echo "âŒ Backend is down"
    curl -f http://localhost:3000 || echo "âŒ Frontend is down"
}

# ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
emergency_rollback() {
    echo "âª ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
    
    LAST_BACKUP=$(ls -t /home/skillsheet/backups/backup_*.tar.gz | head -1)
    
    if [ -f "$LAST_BACKUP" ]; then
        cd /home/skillsheet/app
        tar -xzf "$LAST_BACKUP"
        docker-compose -f docker-compose.prod.yml up -d --force-recreate
        echo "âœ… ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œäº†"
    else
        echo "âŒ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
    fi
}

# ãƒ­ã‚°åŽé›†
collect_logs() {
    echo "ðŸ“‹ ãƒ­ã‚°ã‚’åŽé›†ä¸­..."
    
    INCIDENT_DIR="/tmp/incident_$(date +%Y%m%d_%H%M%S)"
    mkdir -p "$INCIDENT_DIR"
    
    # Dockerãƒ­ã‚°
    docker-compose -f docker-compose.prod.yml logs > "$INCIDENT_DIR/docker.log"
    
    # ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°
    journalctl -u docker --since "1 hour ago" > "$INCIDENT_DIR/system.log"
    
    # Nginxãƒ­ã‚°
    tail -n 1000 /var/log/nginx/error.log > "$INCIDENT_DIR/nginx.log"
    
    tar -czf "$INCIDENT_DIR.tar.gz" "$INCIDENT_DIR"
    echo "âœ… ãƒ­ã‚°åŽé›†å®Œäº†: $INCIDENT_DIR.tar.gz"
}

# ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
toggle_maintenance() {
    echo "ðŸ”§ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆä¸­..."
    
    cat > /etc/nginx/sites-available/maintenance << EOF
server {
    listen 80 default_server;
    listen 443 ssl default_server;
    
    ssl_certificate /etc/letsencrypt/live/skillsheet.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/skillsheet.example.com/privkey.pem;
    
    location / {
        return 503;
        error_page 503 @maintenance;
    }
    
    location @maintenance {
        root /usr/share/nginx/html;
        rewrite ^.*$ /maintenance.html break;
    }
}
EOF

    ln -sf /etc/nginx/sites-available/maintenance /etc/nginx/sites-enabled/default
    nginx -s reload
}

# ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º
show_menu() {
    echo ""
    echo "ç·Šæ€¥å¯¾å¿œã‚ªãƒ—ã‚·ãƒ§ãƒ³:"
    echo "1) ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹ç¢ºèª"
    echo "2) ç·Šæ€¥ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯"
    echo "3) ãƒ­ã‚°åŽé›†"
    echo "4) ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ"
    echo "5) çµ‚äº†"
    echo ""
    read -p "é¸æŠžã—ã¦ãã ã•ã„: " choice
    
    case $choice in
        1) check_services ;;
        2) emergency_rollback ;;
        3) collect_logs ;;
        4) toggle_maintenance ;;
        5) exit 0 ;;
        *) echo "ç„¡åŠ¹ãªé¸æŠžã§ã™" ;;
    esac
}

# ãƒ¡ã‚¤ãƒ³å‡¦ç†
while true; do
    show_menu
done
```

## 8. é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### 8.1 æ—¥æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```markdown
# æ—¥æ¬¡é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

## æœã®ç¢ºèªäº‹é …ï¼ˆ9:00ï¼‰
- [ ] å„ç¨®ã‚µãƒ¼ãƒ“ã‚¹ã®æ­»æ´»ç›£è¦–ç¢ºèª
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç¢ºèª
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨çŽ‡ã®ç¢ºèªï¼ˆ80%ä»¥ä¸‹ï¼‰
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŽ‡ã®ç¢ºèª
- [ ] å‰æ—¥ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆåŠŸç¢ºèª

## æ—¥ä¸­ã®ç›£è¦–äº‹é …
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã®ç›£è¦–
- [ ] APIã‚¨ãƒ©ãƒ¼çŽ‡ã®ç›£è¦–
- [ ] ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã®ç¢ºèª

## å¤•æ–¹ã®ç¢ºèªäº‹é …ï¼ˆ18:00ï¼‰
- [ ] å½“æ—¥ã®ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå¯¾å¿œçŠ¶æ³
- [ ] æ˜Žæ—¥ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹äºˆå®šç¢ºèª
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ©ãƒ¼ãƒˆã®ç¢ºèª
```

### 8.2 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

```markdown
# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

## ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ãªã„å ´åˆ

1. Dockerã‚³ãƒ³ãƒ†ãƒŠã®çŠ¶æ…‹ç¢ºèª
```bash
docker-compose -f docker-compose.prod.yml ps
```

2. ãƒ­ã‚°ã®ç¢ºèª
```bash
docker-compose -f docker-compose.prod.yml logs backend
```

3. ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç¢ºèª
```bash
htop
df -h
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šã‚¨ãƒ©ãƒ¼

1. PostgreSQLã‚³ãƒ³ãƒ†ãƒŠã®ç¢ºèª
```bash
docker-compose -f docker-compose.prod.yml exec postgres pg_isready
```

2. æŽ¥ç¶šè¨­å®šã®ç¢ºèª
```bash
cat .env | grep DATABASE_URL
```

## é«˜è² è·æ™‚ã®å¯¾å¿œ

1. è² è·ã®åŽŸå› ç‰¹å®š
```bash
top
iotop
netstat -tulpn
```

2. ä¸€æ™‚çš„ãªã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ãƒƒãƒ—
```bash
docker-compose -f docker-compose.prod.yml up -d --scale backend=3
```
```

ã“ã®è¨­è¨ˆæ›¸ã«ã‚ˆã‚Šã€ã•ãã‚‰VPSã‚’ä½¿ç”¨ã—ãŸæœ¬æ ¼çš„ãªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚¹ã‚­ãƒ«ã‚·ãƒ¼ãƒˆç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹ç¯‰ãƒ»é‹ç”¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚