# 取引先管理機能 完全実装計画書

## 1. 実装概要

### 1.1 プロジェクト概要
- **機能名**: 取引先企業管理機能
- **実装期間**: 5営業日（40時間）
- **チーム構成**: エンジニアA、エンジニアB（2名体制）
- **並行作業**: フロントエンド・バックエンドを並行開発

### 1.2 実装目標
- 取引先企業のCRUD機能の完全実装
- 取引先ユーザー管理機能の実装
- アクセス権限制御の実装
- エンジニア情報表示権限の管理
- アプローチ機能との連携

## 2. 現在の実装状況

### 2.1 完了済み機能
#### フロントエンド
- ✅ 取引先一覧画面（BusinessPartnerList.tsx）
- ✅ 取引先登録画面（BusinessPartnerRegister.tsx）
- ✅ 取引先詳細画面（BusinessPartnerDetail.tsx）
- ✅ 基本的なUIコンポーネント
- ✅ ルーティング設定

#### バックエンド
- ✅ 認証ミドルウェア（clientAuth.ts）
- ✅ 取引先ユーザーコントローラー（clientUserController.ts）
- ✅ 取引先認証コントローラー（clientAuthController.ts）
- ✅ 取引先エンジニア閲覧コントローラー（clientEngineerController.ts）
- ✅ データベーススキーマ（BusinessPartner、ClientUser）

### 2.2 未実装・改善必要機能
#### フロントエンド
- ❌ APIとの実際の連携（現在モックデータ使用）
- ❌ 取引先ユーザー管理画面
- ❌ アクセス権限設定画面
- ❌ エンジニア表示設定機能
- ❌ エラーハンドリング

#### バックエンド
- ❌ 取引先企業CRUDエンドポイント
- ❌ アクセス権限詳細設定API
- ❌ エンジニア表示フィルタリングロジック
- ❌ バリデーション強化
- ❌ トランザクション処理

## 3. 機能要件詳細

### 3.1 取引先企業管理
| 機能 | 説明 | 権限 |
|-----|------|------|
| 一覧表示 | 全取引先企業のリスト表示 | 管理者・営業 |
| 新規登録 | 取引先企業情報の新規登録 | 管理者・営業 |
| 詳細表示 | 取引先企業の詳細情報表示 | 管理者・営業 |
| 編集 | 取引先企業情報の更新 | 管理者・営業 |
| 削除 | 取引先企業の論理削除 | 管理者のみ |
| ステータス管理 | アクティブ/非アクティブ切替 | 管理者・営業 |

### 3.2 取引先ユーザー管理
| 機能 | 説明 | 権限 |
|-----|------|------|
| ユーザー作成 | 取引先企業用アカウント作成 | 管理者・営業 |
| ユーザー一覧 | 取引先ユーザーリスト表示 | 管理者・営業 |
| ユーザー編集 | アカウント情報更新 | 管理者・営業 |
| ユーザー削除 | アカウント無効化 | 管理者のみ |
| パスワードリセット | パスワード再設定 | 管理者・営業 |

### 3.3 アクセス権限管理
| 機能 | 説明 |
|-----|------|
| エンジニア表示設定 | 表示可能なエンジニアの選択 |
| 待機状況フィルタ | 待機中/待機予定/全員表示 |
| 個別エンジニア設定 | 特定エンジニアの表示/非表示 |
| NGリスト管理 | 表示除外エンジニア設定 |

## 4. 実装タスク詳細

### 4.1 Day 1（月曜日）
#### エンジニアA（バックエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-10:00 | 取引先企業CRUDエンドポイント設計 | API仕様書更新 |
| 10:00-12:00 | BusinessPartnerController実装 | businessPartnerController.ts |
| 13:00-15:00 | バリデーション・エラーハンドリング実装 | validationMiddleware.ts |
| 15:00-17:00 | 単体テスト作成 | businessPartnerController.test.ts |
| 17:00-18:00 | APIドキュメント更新 | swagger.yaml |

#### エンジニアB（フロントエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-10:00 | API連携用サービス層設計 | 設計メモ |
| 10:00-12:00 | BusinessPartnerService実装 | businessPartnerService.ts |
| 13:00-15:00 | Zustandストア実装 | useBusinessPartnerStore.ts |
| 15:00-17:00 | 一覧画面API連携 | BusinessPartnerList.tsx更新 |
| 17:00-18:00 | エラーハンドリング追加 | errorHandler.ts |

### 4.2 Day 2（火曜日）
#### エンジニアA（バックエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-11:00 | アクセス権限管理API実装 | accessControlController.ts |
| 11:00-12:00 | エンジニア表示フィルタリング実装 | engineerFilterService.ts |
| 13:00-15:00 | NGリスト管理機能実装 | ngListController.ts |
| 15:00-17:00 | トランザクション処理実装 | transactionService.ts |
| 17:00-18:00 | 統合テスト作成 | integration.test.ts |

#### エンジニアB（フロントエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-11:00 | 登録画面API連携 | BusinessPartnerRegister.tsx更新 |
| 11:00-12:00 | フォームバリデーション強化 | validation.ts |
| 13:00-15:00 | 詳細画面API連携 | BusinessPartnerDetail.tsx更新 |
| 15:00-17:00 | 編集機能実装 | BusinessPartnerEdit.tsx |
| 17:00-18:00 | ローディング・エラー表示改善 | LoadingComponent.tsx |

### 4.3 Day 3（水曜日）
#### エンジニアA（バックエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-11:00 | 取引先ユーザー管理API拡張 | clientUserController.ts更新 |
| 11:00-12:00 | メール通知機能実装 | emailService.ts |
| 13:00-15:00 | バッチ処理実装（定期権限更新） | batchJobs.ts |
| 15:00-17:00 | パフォーマンス最適化 | queryOptimization.ts |
| 17:00-18:00 | APIセキュリティ強化 | securityMiddleware.ts |

#### エンジニアB（フロントエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-11:00 | 取引先ユーザー管理画面実装 | ClientUserManagement.tsx |
| 11:00-12:00 | ユーザー作成モーダル実装 | CreateUserModal.tsx |
| 13:00-15:00 | アクセス権限設定画面実装 | AccessControlPanel.tsx |
| 15:00-17:00 | エンジニア選択コンポーネント実装 | EngineerSelector.tsx |
| 17:00-18:00 | NGリスト管理画面実装 | NGListManagement.tsx |

### 4.4 Day 4（木曜日）
#### エンジニアA（バックエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-10:00 | ログ出力強化 | logger.ts更新 |
| 10:00-12:00 | 監査ログ実装 | auditLog.ts |
| 13:00-15:00 | APIレート制限実装 | rateLimiter.ts |
| 15:00-17:00 | データマイグレーション作成 | migrations/ |
| 17:00-18:00 | シードデータ作成 | seeds/ |

#### エンジニアB（フロントエンド担当）
| 時間 | タスク | 成果物 |
|------|--------|---------|
| 9:00-11:00 | 検索・フィルタリング機能実装 | SearchFilter.tsx |
| 11:00-12:00 | ページネーション実装 | Pagination.tsx |
| 13:00-15:00 | ソート機能実装 | SortableTable.tsx |
| 15:00-17:00 | 一括操作機能実装 | BulkActions.tsx |
| 17:00-18:00 | エクスポート機能実装 | ExportButton.tsx |

### 4.5 Day 5（金曜日）
#### エンジニアA & B（共同作業）
| 時間 | タスク | 担当 | 成果物 |
|------|--------|------|---------|
| 9:00-10:00 | 統合テスト実施 | 両名 | テスト結果レポート |
| 10:00-11:00 | バグ修正 | 分担 | バグ修正コミット |
| 11:00-12:00 | パフォーマンステスト | A | パフォーマンスレポート |
| 13:00-14:00 | E2Eテスト作成・実施 | B | e2e/ |
| 14:00-15:00 | ドキュメント作成 | 分担 | README.md、API.md |
| 15:00-16:00 | コードレビュー | 相互 | レビューコメント |
| 16:00-17:00 | リファクタリング | 分担 | クリーンコード |
| 17:00-18:00 | デプロイ準備・本番環境テスト | 両名 | デプロイチェックリスト |

## 5. 技術仕様

### 5.1 フロントエンド技術スタック
```typescript
// 主要ライブラリ
- React 18.x + TypeScript
- Ant Design 5.x（UIコンポーネント）
- Zustand（状態管理）
- TanStack Query（データフェッチング）
- Axios（HTTP通信）
- React Hook Form（フォーム管理）
- Yup（バリデーション）
```

### 5.2 バックエンド技術スタック
```typescript
// 主要ライブラリ
- Node.js + Express + TypeScript
- Prisma（ORM）
- PostgreSQL（データベース）
- JWT（認証）
- bcrypt（パスワードハッシュ）
- Winston（ロギング）
- Jest（テスティング）
```

### 5.3 API エンドポイント一覧
```yaml
# 取引先企業管理
GET    /api/business-partners          # 一覧取得
POST   /api/business-partners          # 新規作成
GET    /api/business-partners/:id      # 詳細取得
PUT    /api/business-partners/:id      # 更新
DELETE /api/business-partners/:id      # 削除

# 取引先ユーザー管理
GET    /api/business-partners/:id/users     # ユーザー一覧
POST   /api/business-partners/:id/users     # ユーザー作成
PUT    /api/business-partners/:id/users/:userId  # ユーザー更新
DELETE /api/business-partners/:id/users/:userId  # ユーザー削除

# アクセス権限管理
GET    /api/business-partners/:id/permissions     # 権限取得
PUT    /api/business-partners/:id/permissions     # 権限更新
POST   /api/business-partners/:id/ng-list        # NGリスト追加
DELETE /api/business-partners/:id/ng-list/:engineerId  # NGリスト削除
```

## 6. テスト計画

### 6.1 単体テスト（カバレッジ目標: 80%以上）
- コントローラーテスト
- サービステスト
- ミドルウェアテスト
- コンポーネントテスト
- フック・ユーティリティテスト

### 6.2 統合テスト
- API統合テスト
- データベーストランザクションテスト
- 認証・認可フローテスト

### 6.3 E2Eテスト
- 取引先企業登録フロー
- ユーザー管理フロー
- アクセス権限設定フロー
- エンジニア閲覧フロー

## 7. リスク管理

### 7.1 技術的リスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| API性能問題 | 高 | キャッシュ戦略、インデックス最適化 |
| セキュリティ脆弱性 | 高 | ペネトレーションテスト実施 |
| データ整合性 | 中 | トランザクション、外部キー制約 |

### 7.2 スケジュールリスク
| リスク | 影響度 | 対策 |
|--------|--------|------|
| 仕様変更 | 中 | デイリースクラム、早期確認 |
| バグ修正遅延 | 中 | バッファ時間確保、ペアプロ |
| 環境問題 | 低 | Docker環境統一、CI/CD整備 |

## 8. 成功基準

### 8.1 機能要件
- ✅ 全CRUD操作が正常動作
- ✅ 権限制御が仕様通り動作
- ✅ エラーハンドリング完備
- ✅ レスポンスタイム1秒以内

### 8.2 品質基準
- ✅ テストカバレッジ80%以上
- ✅ 重大バグゼロ
- ✅ セキュリティ脆弱性なし
- ✅ コードレビュー完了

### 8.3 ドキュメント
- ✅ API仕様書完備
- ✅ 操作マニュアル作成
- ✅ トラブルシューティングガイド
- ✅ デプロイ手順書

## 9. 連携・コミュニケーション計画

### 9.1 定例会議
- **デイリースクラム**: 毎日9:00（15分）
- **進捗確認**: 毎日17:00（15分）
- **週次レビュー**: 金曜16:00（30分）

### 9.2 コミュニケーションツール
- **Slack**: リアルタイムコミュニケーション
- **GitHub**: コードレビュー、Issue管理
- **Notion**: ドキュメント共有

### 9.3 ブランチ戦略
```bash
main
├── develop
    ├── feature/business-partner-backend (エンジニアA)
    └── feature/business-partner-frontend (エンジニアB)
```

## 10. 完了後の次ステップ

### 10.1 本番デプロイ
1. ステージング環境でのテスト
2. 本番環境へのデプロイ
3. スモークテスト実施
4. 監視設定

### 10.2 運用移行
1. 運用マニュアル作成
2. サポートチームへの引き継ぎ
3. ユーザートレーニング
4. フィードバック収集

### 10.3 改善計画
1. パフォーマンスモニタリング
2. ユーザビリティ改善
3. 機能拡張検討
4. 技術的負債の解消

---

## 付録A: コード規約

### TypeScript/JavaScript
- ESLint + Prettier使用
- 命名規則: camelCase（変数・関数）、PascalCase（クラス・型）
- コメント: JSDoc形式

### Git コミットメッセージ
```
feat: 機能追加
fix: バグ修正
docs: ドキュメント
style: フォーマット
refactor: リファクタリング
test: テスト
chore: その他
```

## 付録B: 緊急時対応

### 障害発生時
1. 影響範囲の特定
2. ロールバック判断
3. ホットフィックス適用
4. 事後報告書作成

### エスカレーションパス
1. チームリーダー
2. プロジェクトマネージャー
3. テクニカルリード
4. CTO

---

作成日: 2025年1月19日
作成者: Claude Code
バージョン: 1.0.0