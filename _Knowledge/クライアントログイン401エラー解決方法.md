# クライアントログイン401エラー解決方法

## 問題
`http://localhost:3000/client/login` で `admin@client-a.co.jp` を使用してログインしようとすると401 Unauthorizedエラーが発生する。

## エラー内容
```
POST http://localhost:8000/api/client/auth/login 401 (Unauthorized)
```

## 原因
データベースにクライアントユーザーが存在しない、またはロール作成時に必須フィールドが不足していた。

## 解決方法

### 1. スクリプトの修正
`backend/scripts/createOfficialClientUsers.ts` でロール作成時に `displayName` フィールドを追加：

```typescript
// client_adminロール作成時
adminRole = await prisma.role.create({
  data: {
    name: 'client_admin',
    displayName: '取引先管理者',  // 必須フィールドを追加
    description: '取引先企業管理者ロール'
  }
});

// client_userロール作成時
userRole = await prisma.role.create({
  data: {
    name: 'client_user',
    displayName: '取引先ユーザー',  // 必須フィールドを追加
    description: '取引先企業一般ユーザーロール'
  }
});
```

### 2. クライアントユーザーの作成
修正したスクリプトを実行してユーザーを作成：

```bash
docker exec compactskillsheetsapp-backend-1 npx tsx scripts/createOfficialClientUsers.ts
```

### 3. 作成されるデモアカウント

#### 株式会社クライアントA
- メール: admin@client-a.co.jp
- パスワード: Admin123!
- 権限: 取引先管理者（全エンジニア閲覧可能）

#### 株式会社クライアントB
- メール: user@client-b.co.jp
- パスワード: Admin123!
- 権限: 取引先ユーザー（待機中エンジニアのみ閲覧可能）

### 4. 動作確認
curlコマンドでAPIの動作を確認：

```bash
curl -X POST http://localhost:8000/api/client/auth/login \
  -H "Content-Type: application/json" \
  -d "{\"email\":\"admin@client-a.co.jp\",\"password\":\"Admin123!\"}"
```

正常なレスポンス例：
```json
{
  "message": "ログインに成功しました",
  "accessToken": "eyJhbGciOiJI...",
  "refreshToken": "eyJhbGciOiJI...",
  "user": {
    "id": "1",
    "email": "admin@client-a.co.jp",
    "name": "クライアントA管理者",
    "department": "管理部",
    "position": "部長",
    "userType": "client",
    "clientCompany": {
      "id": "3",
      "name": "株式会社クライアントA"
    },
    "sesCompany": {
      "id": "2",
      "name": "株式会社テストSES"
    },
    "roles": [],
    "permissions": []
  }
}
```

## 関連ファイル
- `/backend/scripts/createOfficialClientUsers.ts` - クライアントユーザー作成スクリプト
- `/backend/src/controllers/clientAuthController.ts` - クライアント認証コントローラー
- `/backend/src/routes/clientRoutes.ts` - クライアント用ルート定義
- `/frontend/src/stores/clientAuthStore.ts` - フロントエンドの認証ストア
- `/frontend/src/pages/auth/ClientLogin.tsx` - クライアントログイン画面

## 記録日
2025-08-19